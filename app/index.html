<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <!-- Vue 2 -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>

  <!-- tailwind -->
  <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">

  <!-- chartJs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.1/dist/chart.min.js"></script>

  <link href="styles.css" rel="stylesheet" >

  <title>WebSockets with Vue</title>
</head>
<body>

  <main class="container mx-auto py-10 px-5">

    <h1 class="text-3xl mb-5">WebSockets & Vue</h1>
    <hr class="my-10" />

    <!-- vue app mounted within #wsDemo -->
    <section id="wsDemo" class="mb-10">

      </form>


      <!-- value is sent from wsServer in to Vue app and auto updated here -->
      <h2 class="text-xl mb-5">Progress Bar</h2>
      <p class="mb-2">Values sent from WebSocket server and updated via Vue</p>

      <progress class="shadow-lg" max="100" v-bind:value="progressValue" ></progress>
      <small class="mb-5 block">{{progressValue}} / 100</small>

      <hr class="my-10"/>

      <h2 class="text-xl mb-5">Chart Js</h2>
      <p class="mb-2">Values updated from WebSocket server</p>
      <canvas ref="chart" id="myChart" class="mb-5"></canvas>
    </section>

  </main>

  <script defer>
    // WebSocket setup
    const HOST = location.origin.replace(/^http/, 'ws')
    const client = new WebSocket(HOST)

     const app = new Vue({
      el: '#wsDemo',
      data() {
        return {
          counter: 0,
          progressValue: 10,
          chartData: [0, 0, 0, 0, 0, 0],
          chart: null,
          messageCopy: '',
          messages: []
        }
      },
      created () {
        client.addEventListener(('open'), function () {
          // logout when connected
          console.info('WebSocket connected')
        })
      },
      mounted () {
        // init chart
        this.initChart()

        client.addEventListener( ('message'), (event) => {
        })
      },
      methods: {
        // initChart to setup ChartJS
        initChart () {
          this.chart = new Chart(this.$refs['chart'], {
            type: 'bar',
            data: {
              labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
              datasets: [{
                label: '# of Votes',
                data: [1, 1, 1, 1, 1, 1],
                backgroundColor: [
                  'rgba(255, 99, 132, 0.2)',
                  'rgba(54, 162, 235, 0.2)',
                  'rgba(255, 206, 86, 0.2)',
                  'rgba(75, 192, 192, 0.2)',
                  'rgba(153, 102, 255, 0.2)',
                  'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                  'rgba(255, 99, 132, 1)',
                  'rgba(54, 162, 235, 1)',
                  'rgba(255, 206, 86, 1)',
                  'rgba(75, 192, 192, 1)',
                  'rgba(153, 102, 255, 1)',
                  'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
              }]
            },
            options: {
              aspectRatio: 2,
              scales: {
                y: {
                  beginAtZero: true,
                  suggestedMax: 110
                }
              }
            }
          })
        },

        updateProgressBar (data) {
          this.progressValue = data
        },

        updateMessages (message) {
          this.messages.push(message)
        }
      }
    }) // end vue

  </script>

</body>
</html>